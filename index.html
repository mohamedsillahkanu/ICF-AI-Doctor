<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Medical Assistant - Free Consultation</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            font-family: 'Oswald', Arial, sans-serif;
            color: #000000;
            font-weight: 700;
            padding: 20px;
        }

        .page-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER */
        .page-header {
            background-color: #004080;
            color: #ffffff;
            padding: 25px 30px;
            text-align: center;
            margin-bottom: 10px;
        }

        .page-header img {
            width: 140px;
            vertical-align: middle;
            border: none;
            border-radius: 8px;
        }

        .page-header h3 {
            margin: 12px 0 5px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #ffffff;
        }

        .page-header .tagline {
            margin: 0;
            font-size: 10px;
            font-weight: 700;
            color: #ffffff;
        }

        .page-header h1 {
            margin: 20px 0 10px;
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 1px;
        }

        .page-header .subtitle {
            font-size: 13px;
            color: #ffffff;
            font-weight: 700;
        }

        /* CONTROLS */
        .controls-bar {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-btn {
            background: #004080;
            color: #ffffff;
            border: 2px solid #004080;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Oswald', Arial, sans-serif;
            letter-spacing: 0.5px;
        }

        .control-btn:hover {
            background: #0056b3;
            border-color: #0056b3;
            color: #ffffff;
        }

        /* STATUS BAR */
        .status-bar {
            background: #ffffff;
            border: 2px solid #004080;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.online {
            background: #28a745;
        }

        .status-indicator.offline {
            background: #dc3545;
        }

        .status-text {
            font-weight: 700;
            font-size: 14px;
            color: #000000;
        }

        /* CHAT CARD */
        .chat-card {
            border: 4px double #004080;
            border-radius: 12px;
            padding: 12px;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .chat-content {
            padding: 20px;
        }

        /* DISCLAIMER */
        .disclaimer-box {
            background: #e7f3ff;
            border: 2px solid #004080;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .disclaimer-title {
            font-size: 14px;
            font-weight: 700;
            color: #004080;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .disclaimer-text {
            font-size: 12px;
            font-weight: 700;
            color: #000000;
            line-height: 1.6;
        }

        /* MESSAGES */
        .messages-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border: 2px solid #004080;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.assistant {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 75%;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
            font-weight: 700;
        }

        .message.user .message-bubble {
            background: #004080;
            color: #ffffff;
            border-bottom-right-radius: 0;
        }

        .message.assistant .message-bubble {
            background: #ffffff;
            color: #000000;
            border: 2px solid #004080;
            border-bottom-left-radius: 0;
        }

        .message-header {
            font-size: 12px;
            color: #004080;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dee2e6;
        }

        .typing-indicator {
            background: #ffffff;
            border: 2px solid #004080;
            padding: 15px 20px;
            border-radius: 12px;
            border-bottom-left-radius: 0;
            max-width: 75%;
        }

        .typing-dots {
            display: flex;
            gap: 6px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #004080;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
            }
            30% {
                opacity: 1;
            }
        }

        /* INPUT AREA */
        .input-container {
            border: 2px solid #004080;
            border-radius: 8px;
            padding: 15px;
            background: #ffffff;
        }

        .input-row {
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid #004080;
            border-radius: 6px;
            color: #000000;
            font-size: 16px;
            font-family: 'Oswald', Arial, sans-serif;
            font-weight: 700;
        }

        .input-field:focus {
            outline: none;
            border-color: #004080;
            background: #ffffff;
        }

        .input-field:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .send-btn {
            padding: 12px 30px;
            background: #004080;
            color: #ffffff;
            border: 2px solid #004080;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Oswald', Arial, sans-serif;
            letter-spacing: 0.5px;
        }

        .send-btn:hover:not(:disabled) {
            background: #0056b3;
            border-color: #0056b3;
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .input-hint {
            font-size: 11px;
            color: #6c757d;
            margin-top: 10px;
            text-align: center;
            font-weight: 700;
        }

        /* FOOTER */
        .page-footer {
            background-color: #004080;
            color: #ffffff;
            padding: 20px 30px;
            text-align: center;
            font-size: 13px;
            line-height: 1.7;
            font-weight: 700;
        }

        .page-footer p {
            margin: 6px 0 0;
            font-size: 12px;
            color: #ffffff;
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffffff;
            border: 2px solid #004080;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1000;
            max-width: 400px;
        }

        .notification.show {
            display: block;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .notification.success {
            border-left: 4px solid #28a745;
        }

        .notification.error {
            border-left: 4px solid #dc3545;
        }

        .notification.info {
            border-left: 4px solid #004080;
        }

        .notification-text {
            color: #000000;
            font-size: 14px;
            font-weight: 700;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .chat-content {
                padding: 15px;
            }

            .messages-container {
                height: 400px;
            }

            .message-bubble {
                max-width: 85%;
            }

            .input-row {
                flex-direction: column;
            }

            .send-btn {
                width: 100%;
            }

            .notification {
                left: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- HEADER -->
        <div class="page-header">
            <img src="https://github.com/mohamedsillahkanu/gdp-dashboard-2/raw/6c7463b0d5c3be150aafae695a4bcbbd8aeb1499/ICF-SL.jpg" alt="ICF-SL Logo">
            <h3>Informatics Consultancy Firm-Sierra Leone<br>(ICF-SL)</h3>
            <p class="tagline"><em>Driving Data-Driven Solutions for Health and Development</em></p>
            <h1>AI MEDICAL ASSISTANT</h1>
            <p class="subtitle">FREE HEALTH CONSULTATION SERVICE</p>
        </div>

        <!-- CONTROLS -->
        <div class="controls-bar">
            <button class="control-btn" onclick="clearConversation()">NEW CONSULTATION</button>
        </div>

        <!-- STATUS BAR -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span class="status-text" id="statusText">CHECKING CONNECTION...</span>
            </div>
        </div>

        <!-- CHAT CARD -->
        <div class="chat-card">
            <div class="chat-content">
                <!-- DISCLAIMER -->
                <div class="disclaimer-box">
                    <div class="disclaimer-title">MEDICAL DISCLAIMER</div>
                    <div class="disclaimer-text">
                        This AI Medical Assistant provides health information and guidance only. It does not replace professional medical diagnosis or treatment. Always consult qualified healthcare providers for medical concerns. In case of emergency, contact your nearest health facility immediately.
                    </div>
                </div>

                <!-- MESSAGES -->
                <div class="messages-container" id="messagesContainer">
                    <div class="message assistant">
                        <div class="message-bubble">
                            <div class="message-header">AI MEDICAL ASSISTANT</div>
                            <div>
                                HELLO AND WELCOME TO YOUR FREE MEDICAL CONSULTATION.<br><br>
                                I AM HERE TO HELP UNDERSTAND YOUR SYMPTOMS AND PROVIDE HEALTH GUIDANCE. PLEASE DESCRIBE HOW YOU ARE FEELING TODAY, AND I WILL ASK FOLLOW-UP QUESTIONS TO BETTER UNDERSTAND YOUR CONDITION.<br><br>
                                PLEASE BE AS DETAILED AS POSSIBLE ABOUT YOUR SYMPTOMS.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INPUT AREA -->
                <div class="input-container">
                    <form id="chatForm">
                        <div class="input-row">
                            <input 
                                type="text" 
                                class="input-field" 
                                id="userInput" 
                                placeholder="DESCRIBE YOUR SYMPTOMS OR ANSWER THE QUESTIONS..."
                                autocomplete="off"
                            >
                            <button type="submit" class="send-btn" id="sendBtn">SEND</button>
                        </div>
                        <div class="input-hint">YOUR CONVERSATION IS PRIVATE AND SECURE</div>
                    </form>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="page-footer">
            <p style="margin: 0;">National Malaria Control Programme</p>
            <p>Ministry of Health and Sanitation, Sierra Leone</p>
            <p style="font-size: 11px;">Medical Stores Compound, Freetown, Sierra Leone</p>
            <p style="font-size: 10px;">Â© 2025 Informatics Consultancy Firm-Sierra Leone (ICF-SL)</p>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification">
        <span class="notification-text" id="notificationText"></span>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            // REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzGaxFrsuxJ3qz6lwImV3_POwLAGxz3mt1--yEQ36vMlH9VIhwPyEQ_hgk-NKLsJZWRng/exec'
        };

        // ============================================
        // STATE
        // ============================================
        const state = {
            messages: [],
            isOnline: navigator.onLine,
            isProcessing: false
        };

        // ============================================
        // SYSTEM PROMPT
        // ============================================
        const SYSTEM_PROMPT = `You are an AI Medical Assistant conducting a patient consultation. Your role is to:

1. INITIAL ASSESSMENT: Listen to the patient's symptoms carefully
2. DETAILED INQUIRY: Ask relevant follow-up questions to understand:
   - Duration and onset of symptoms
   - Severity (scale of 1-10 where applicable)
   - Associated symptoms
   - Medical history relevance
   - Current medications
   - Allergies
   - Recent travel or exposure
   
3. PROGRESSIVE QUESTIONING: Ask 3-5 focused questions, one or two at a time, to build a complete picture

4. FINAL ASSESSMENT: After gathering sufficient information, provide:
   - LIKELY DIAGNOSIS: Most probable condition(s)
   - RECOMMENDED MEDICATIONS: Over-the-counter or prescription suggestions with dosages
   - HOME CARE INSTRUCTIONS: Self-care measures
   - WARNING SIGNS: When to seek immediate care
   - FOLLOW-UP RECOMMENDATION: Whether and when to see a doctor

GUIDELINES:
- Be empathetic and professional
- Ask clear, specific questions
- Do not diagnose immediately - gather information first
- Always recommend seeing a doctor for serious symptoms
- Provide medication suggestions but emphasize consulting a pharmacist/doctor
- Use simple, patient-friendly language
- If symptoms suggest emergency (chest pain, difficulty breathing, severe bleeding, etc.), immediately advise seeking emergency care
- Format your responses clearly with proper spacing
- Use capital letters for section headers when giving final assessment

Begin by acknowledging their symptoms and asking your first follow-up question.`;

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            updateOnlineStatus();
            setupEventListeners();
            
            // Check configuration
            if (CONFIG.APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                showNotification('PLEASE CONFIGURE GOOGLE APPS SCRIPT URL', 'error');
            }
        }

        function setupEventListeners() {
            document.getElementById('chatForm').addEventListener('submit', handleSubmit);
            window.addEventListener('online', handleOnlineEvent);
            window.addEventListener('offline', handleOfflineEvent);
        }

        function handleOnlineEvent() {
            state.isOnline = true;
            updateOnlineStatus();
            showNotification('CONNECTION RESTORED', 'success');
        }

        function handleOfflineEvent() {
            state.isOnline = false;
            updateOnlineStatus();
            showNotification('NO INTERNET CONNECTION', 'error');
        }

        function updateOnlineStatus() {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (state.isOnline) {
                indicator.className = 'status-indicator online';
                text.textContent = 'CONNECTED';
            } else {
                indicator.className = 'status-indicator offline';
                text.textContent = 'OFFLINE';
            }
        }

        // ============================================
        // MESSAGE HANDLING
        // ============================================
        async function handleSubmit(e) {
            e.preventDefault();
            
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message || state.isProcessing) return;
            
            // Check configuration
            if (CONFIG.APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                showNotification('SYSTEM NOT CONFIGURED. PLEASE SET UP GOOGLE APPS SCRIPT URL.', 'error');
                return;
            }
            
            // Check connection
            if (!state.isOnline) {
                showNotification('NO INTERNET CONNECTION. PLEASE CHECK YOUR CONNECTION.', 'error');
                return;
            }
            
            // Add user message
            addMessage('user', message);
            state.messages.push({ role: 'user', content: message });
            
            // Clear input
            input.value = '';
            input.disabled = true;
            document.getElementById('sendBtn').disabled = true;
            state.isProcessing = true;
            
            // Show typing indicator
            showTypingIndicator();
            
            // Get AI response
            await getAIResponse();
            
            // Re-enable input
            hideTypingIndicator();
            input.disabled = false;
            document.getElementById('sendBtn').disabled = false;
            state.isProcessing = false;
            input.focus();
        }

        function addMessage(role, content) {
            const container = document.getElementById('messagesContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            if (role === 'assistant') {
                messageDiv.innerHTML = `
                    <div class="message-bubble">
                        <div class="message-header">AI MEDICAL ASSISTANT</div>
                        <div>${escapeHtml(content).replace(/\n/g, '<br>')}</div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-bubble">${escapeHtml(content).replace(/\n/g, '<br>')}</div>
                `;
            }
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'message assistant';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        async function getAIResponse() {
            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: state.messages
                    })
                });

                if (!response.ok) {
                    throw new Error(`SERVER ERROR: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                const assistantMessage = data.content[0].text;
                addMessage('assistant', assistantMessage);
                state.messages.push({ role: 'assistant', content: assistantMessage });
                
            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                addMessage('assistant', 'I APOLOGIZE, BUT I ENCOUNTERED AN ERROR. PLEASE TRY AGAIN. IF THE PROBLEM PERSISTS AND YOUR SYMPTOMS ARE URGENT, PLEASE SEEK IN-PERSON MEDICAL CARE IMMEDIATELY.');
                showNotification('COMMUNICATION ERROR: ' + error.message, 'error');
            }
        }

        function clearConversation() {
            if (!confirm('START A NEW CONSULTATION? THIS WILL CLEAR THE CURRENT CONVERSATION.')) {
                return;
            }
            
            state.messages = [];
            
            const container = document.getElementById('messagesContainer');
            container.innerHTML = `
                <div class="message assistant">
                    <div class="message-bubble">
                        <div class="message-header">AI MEDICAL ASSISTANT</div>
                        <div>
                            HELLO AND WELCOME TO YOUR FREE MEDICAL CONSULTATION.<br><br>
                            I AM HERE TO HELP UNDERSTAND YOUR SYMPTOMS AND PROVIDE HEALTH GUIDANCE. PLEASE DESCRIBE HOW YOU ARE FEELING TODAY, AND I WILL ASK FOLLOW-UP QUESTIONS TO BETTER UNDERSTAND YOUR CONDITION.<br><br>
                            PLEASE BE AS DETAILED AS POSSIBLE ABOUT YOUR SYMPTOMS.
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('userInput').value = '';
            document.getElementById('userInput').focus();
            showNotification('NEW CONSULTATION STARTED', 'info');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            notification.className = `notification ${type} show`;
            text.textContent = message;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // START APPLICATION
        // ============================================
        init();
    </script>
</body>
</html>
